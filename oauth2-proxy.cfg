# OAuth2 Proxy Configuration
# This file configures OAuth2 Proxy for authentication with Keycloak

# Provider Configuration
provider = "keycloak"
client_id = "sevensa-oauth2-proxy"
client_secret_file = "/run/secrets/oauth2_proxy_client_secret"
oidc_issuer_url = "https://keycloak.sevensa.nl/realms/sevensa"
login_url = "https://keycloak.sevensa.nl/realms/sevensa/protocol/openid-connect/auth"
redeem_url = "https://keycloak.sevensa.nl/realms/sevensa/protocol/openid-connect/token"
validate_url = "https://keycloak.sevensa.nl/realms/sevensa/protocol/openid-connect/userinfo"
profile_url = "https://keycloak.sevensa.nl/realms/sevensa/protocol/openid-connect/userinfo"
scope = "openid profile email"

# Proxy Configuration
http_address = "0.0.0.0:4180"
reverse_proxy = true
upstreams = ["file:///dev/null"]
pass_host_header = true
skip_provider_button = true
skip_auth_preflight = true
skip_auth_routes = [
  "/health",
  "/ping",
  "/.well-known/",
  "/favicon.ico"
]

# Cookie Configuration
cookie_name = "sevensa_oauth2_proxy"
cookie_secret_file = "/run/secrets/oauth2_proxy_cookie_secret"
cookie_secure = true
cookie_httponly = true
cookie_samesite = "lax"
cookie_expire = "8h"
cookie_refresh = "1h"
cookie_domains = [".sevensa.nl"]

# Session Configuration
session_store_type = "cookie"

# Authentication Configuration
email_domains = "*"
authenticated_emails_file = ""
whitelist_domains = [".sevensa.nl"]

# Request/Response Headers
pass_access_token = true
pass_user_headers = true
pass_authorization_header = true
set_authorization_header = true
set_xauthrequest = true

# User ID Configuration
user_id_claim = "email"

# Request Headers
request_logging = true
auth_logging = true
standard_logging = true

# Custom Headers
request_header = "X-Auth-Request-User:{{.User}}"
request_header = "X-Auth-Request-Email:{{.Email}}"
request_header = "X-Auth-Request-Groups:{{.Groups}}"
request_header = "X-Auth-Request-Access-Token:{{.AccessToken}}"

# Custom Templates
custom_templates_dir = "/etc/oauth2-proxy/templates"

# Logging Configuration
silence_ping_logging = true
logging_filename = ""
logging_max_size = 100
logging_max_age = 7
logging_max_backups = 5
logging_compress = true
standard_logging_format = "[{{.Timestamp}}] [{{.File}}] {{.Message}}"
request_logging_format = "[{{.Timestamp}}] [{{.Status}}] [{{.Duration}}] {{.Host}} {{.Method}} {{.Path}}"
auth_logging_format = "[{{.Timestamp}}] [{{.Status}}] [{{.Duration}}] {{.Host}} {{.Method}} {{.Path}} {{.Error}}"
