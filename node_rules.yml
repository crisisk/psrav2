groups:
- name: node_alerts
  rules:
  # Alert voor hoge CPU gebruik
  - alert: HighCPUUsage
    expr: 100 - (avg by(instance) (irate(node_cpu_seconds_total{mode="idle"}[5m])) * 100) > 80
    for: 5m
    labels:
      severity: warning
    annotations:
      summary: "High CPU usage on {{ $labels.instance }}"
      description: "CPU usage is above 80% for more than 5 minutes.\n  VALUE = {{ $value }}%\n  LABELS = {{ $labels }}"

  # Alert voor hoge geheugen gebruik
  - alert: HighMemoryUsage
    expr: (node_memory_MemTotal_bytes - node_memory_MemAvailable_bytes) / node_memory_MemTotal_bytes * 100 > 85
    for: 5m
    labels:
      severity: warning
    annotations:
      summary: "High memory usage on {{ $labels.instance }}"
      description: "Memory usage is above 85% for more than 5 minutes.\n  VALUE = {{ $value }}%\n  LABELS = {{ $labels }}"

  # Alert voor hoge disk gebruik
  - alert: HighDiskUsage
    expr: 100 - ((node_filesystem_avail_bytes{mountpoint="/"} * 100) / node_filesystem_size_bytes{mountpoint="/"}) > 85
    for: 5m
    labels:
      severity: warning
    annotations:
      summary: "High disk usage on {{ $labels.instance }}:{{ $labels.mountpoint }}"
      description: "Disk usage is above 85% for more than 5 minutes.\n  VALUE = {{ $value }}%\n  LABELS = {{ $labels }}"

  # Alert voor disk bijna vol
  - alert: DiskWillFillIn4Hours
    expr: predict_linear(node_filesystem_free_bytes{mountpoint="/"}[1h], 4 * 3600) < 0
    for: 5m
    labels:
      severity: critical
    annotations:
      summary: "Disk will fill in 4 hours on {{ $labels.instance }}:{{ $labels.mountpoint }}"
      description: "Disk will fill in 4 hours at current write rate.\n  VALUE = {{ $value }}bytes\n  LABELS = {{ $labels }}"

  # Alert voor hoge load average
  - alert: HighLoadAverage
    expr: node_load1 > (count by(instance) (node_cpu_seconds_total{mode="idle"}) * 0.8)
    for: 5m
    labels:
      severity: warning
    annotations:
      summary: "High load average on {{ $labels.instance }}"
      description: "Load average is high for more than 5 minutes.\n  VALUE = {{ $value }}\n  LABELS = {{ $labels }}"

  # Alert voor netwerk errors
  - alert: NetworkErrors
    expr: rate(node_network_transmit_errs_total[5m]) + rate(node_network_receive_errs_total[5m]) > 0
    for: 5m
    labels:
      severity: warning
    annotations:
      summary: "Network errors on {{ $labels.instance }}"
      description: "Network errors detected for more than 5 minutes.\n  VALUE = {{ $value }}\n  LABELS = {{ $labels }}"

  # Alert voor node down
  - alert: NodeDown
    expr: up{job="node"} == 0
    for: 1m
    labels:
      severity: critical
    annotations:
      summary: "Node {{ $labels.instance }} is down"
      description: "Node has been down for more than 1 minute.\n  VALUE = {{ $value }}\n  LABELS = {{ $labels }}"

  # Alert voor hoge swap gebruik
  - alert: HighSwapUsage
    expr: (node_memory_SwapTotal_bytes - node_memory_SwapFree_bytes) / node_memory_SwapTotal_bytes * 100 > 80
    for: 5m
    labels:
      severity: warning
    annotations:
      summary: "High swap usage on {{ $labels.instance }}"
      description: "Swap usage is above 80% for more than 5 minutes.\n  VALUE = {{ $value }}%\n  LABELS = {{ $labels }}"

  # Alert voor te veel open files
  - alert: TooManyOpenFiles
    expr: node_filefd_allocated / node_filefd_maximum * 100 > 70
    for: 5m
    labels:
      severity: warning
    annotations:
      summary: "Too many open files on {{ $labels.instance }}"
      description: "More than 70% of file descriptors are used for more than 5 minutes.\n  VALUE = {{ $value }}%\n  LABELS = {{ $labels }}"
